import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{j as c,J as A}from"./index-USkqr3S0.js";import{r as h}from"./index-BJYSoprK.js";import{u as N}from"./variants-Y11x64Ch.js";import{P as I}from"./ProductPrice-CkhAoVt5.js";import{I as k}from"./Image-C8hgQviM.js";import{L as b}from"./components-y71cCI0k.js";import{M as L}from"./Money-gTdCFF4I.js";function U({children:t,heading:n,type:s}){const{type:i,close:r}=p(),a=s===i;return h.useEffect(()=>{const o=new AbortController;return a&&document.addEventListener("keydown",function(l){l.key==="Escape"&&r()},{signal:o.signal}),()=>o.abort()},[r,a]),e.jsxs("div",{"aria-modal":!0,className:`overlay ${a?"expanded":""}`,role:"dialog",children:[e.jsx("button",{className:"close-outside",onClick:r}),e.jsxs("aside",{children:[e.jsxs("header",{children:[e.jsx("h3",{children:n}),e.jsx("button",{className:"close reset",onClick:r,"aria-label":"Close",children:"×"})]}),e.jsx("main",{children:t})]})]})}const v=h.createContext(null);U.Provider=function({children:n}){const[s,i]=h.useState("closed");return e.jsx(v.Provider,{value:{type:s,open:i,close:()=>i("closed")},children:n})};function p(){const t=h.useContext(v);if(!t)throw new Error("useAside must be used within an AsideProvider");return t}function w({layout:t,line:n}){var x;const{id:s,merchandise:i}=n,{product:r,title:a,image:o,selectedOptions:d}=i,l=N(r.handle,d),{close:j}=p();return e.jsxs("li",{className:"cart-line",children:[o&&e.jsx(k,{alt:a,aspectRatio:"1/1",data:o,height:100,loading:"lazy",width:100}),e.jsxs("div",{children:[e.jsx(b,{prefetch:"intent",to:l,onClick:()=>{t==="aside"&&j()},children:e.jsx("p",{children:e.jsx("strong",{children:r.title})})}),e.jsx(I,{price:(x=n==null?void 0:n.cost)==null?void 0:x.totalAmount}),e.jsx("ul",{children:d.map(u=>e.jsx("li",{children:e.jsxs("small",{children:[u.name,": ",u.value]})},u.name))}),e.jsx(q,{line:n})]})]},s)}function q({line:t}){if(!t||typeof(t==null?void 0:t.quantity)>"u")return null;const{id:n,quantity:s,isOptimistic:i}=t,r=Number(Math.max(0,s-1).toFixed(0)),a=Number((s+1).toFixed(0));return e.jsxs("div",{className:"cart-line-quantity",children:[e.jsxs("small",{children:["Quantity: ",s,"   "]}),e.jsx(f,{lines:[{id:n,quantity:r}],children:e.jsx("button",{"aria-label":"Decrease quantity",disabled:s<=1||!!i,name:"decrease-quantity",value:r,children:e.jsx("span",{children:"− "})})})," ",e.jsx(f,{lines:[{id:n,quantity:a}],children:e.jsx("button",{"aria-label":"Increase quantity",name:"increase-quantity",value:a,disabled:!!i,children:e.jsx("span",{children:"+"})})})," ",e.jsx(D,{lineIds:[n],disabled:!!i})]})}function D({lineIds:t,disabled:n}){return e.jsx(c,{fetcherKey:g(t),route:"/cart",action:c.ACTIONS.LinesRemove,inputs:{lineIds:t},children:e.jsx("button",{disabled:n,type:"submit",children:"Remove"})})}function f({children:t,lines:n}){const s=n.map(i=>i.id);return e.jsx(c,{fetcherKey:g(s),route:"/cart",action:c.ACTIONS.LinesUpdate,inputs:{lines:n},children:t})}function g(t){return[c.ACTIONS.LinesUpdate,...t].join("-")}function R({cart:t,layout:n}){var i,r,a;const s=n==="page"?"cart-summary-page":"cart-summary-aside";return e.jsxs("div",{"aria-labelledby":"cart-summary",className:s,children:[e.jsx("h4",{children:"Totals"}),e.jsxs("dl",{className:"cart-subtotal",children:[e.jsx("dt",{children:"Subtotal"}),e.jsx("dd",{children:(r=(i=t.cost)==null?void 0:i.subtotalAmount)!=null&&r.amount?e.jsx(L,{data:(a=t.cost)==null?void 0:a.subtotalAmount}):"-"})]}),e.jsx(T,{discountCodes:t.discountCodes}),e.jsx(E,{giftCardCodes:t.appliedGiftCards}),e.jsx(S,{checkoutUrl:t.checkoutUrl})]})}function S({checkoutUrl:t}){return t?e.jsxs("div",{children:[e.jsx("a",{href:t,target:"_self",children:e.jsx("p",{children:"Continue to Checkout →"})}),e.jsx("br",{})]}):null}function T({discountCodes:t}){var s;const n=((s=t==null?void 0:t.filter(i=>i.applicable))==null?void 0:s.map(({code:i})=>i))||[];return e.jsxs("div",{children:[e.jsx("dl",{hidden:!n.length,children:e.jsxs("div",{children:[e.jsx("dt",{children:"Discount(s)"}),e.jsx(C,{children:e.jsxs("div",{className:"cart-discount",children:[e.jsx("code",{children:n==null?void 0:n.join(", ")})," ",e.jsx("button",{children:"Remove"})]})})]})}),e.jsx(C,{discountCodes:n,children:e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"discountCode",placeholder:"Discount code"})," ",e.jsx("button",{type:"submit",children:"Apply"})]})})]})}function C({discountCodes:t,children:n}){return e.jsx(c,{route:"/cart",action:c.ACTIONS.DiscountCodesUpdate,inputs:{discountCodes:t||[]},children:n})}function E({giftCardCodes:t}){const n=h.useRef([]),s=h.useRef(null),i=(t==null?void 0:t.map(({lastCharacters:o})=>`***${o}`))||[];function r(o){const d=o.replace(/\s/g,"");n.current.includes(d)||n.current.push(d),s.current.value=""}function a(){n.current=[]}return e.jsxs("div",{children:[e.jsx("dl",{hidden:!i.length,children:e.jsxs("div",{children:[e.jsx("dt",{children:"Applied Gift Card(s)"}),e.jsx(y,{children:e.jsxs("div",{className:"cart-discount",children:[e.jsx("code",{children:i==null?void 0:i.join(", ")})," ",e.jsx("button",{onSubmit:()=>a,children:"Remove"})]})})]})}),e.jsx(y,{giftCardCodes:n.current,saveAppliedCode:r,children:e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"giftCardCode",placeholder:"Gift card code",ref:s})," ",e.jsx("button",{type:"submit",children:"Apply"})]})})]})}function y({giftCardCodes:t,saveAppliedCode:n,children:s}){return e.jsx(c,{route:"/cart",action:c.ACTIONS.GiftCardCodesUpdate,inputs:{giftCardCodes:t||[]},children:i=>{var a;const r=(a=i.formData)==null?void 0:a.get("giftCardCode");return r&&n&&n(r),s}})}function J({layout:t,cart:n}){var d,l,j,x,u;const s=A(n),i=!!((l=(d=s==null?void 0:s.lines)==null?void 0:d.nodes)!=null&&l.length),a=`cart-main ${s&&!!((x=(j=s==null?void 0:s.discountCodes)==null?void 0:j.filter(m=>m.applicable))!=null&&x.length)?"with-discount":""}`,o=s!=null&&s.totalQuantity?s.totalQuantity>0:!1;return e.jsxs("div",{className:a,children:[e.jsx(G,{hidden:i,layout:t}),e.jsxs("div",{className:"cart-details",children:[e.jsx("div",{"aria-labelledby":"cart-lines",children:e.jsx("ul",{children:(((u=s==null?void 0:s.lines)==null?void 0:u.nodes)??[]).map(m=>e.jsx(w,{line:m,layout:t},m.id))})}),o&&e.jsx(R,{cart:s,layout:t})]})]})}function G({hidden:t=!1}){const{close:n}=p();return e.jsxs("div",{hidden:t,children:[e.jsx("br",{}),e.jsx("p",{children:"Looks like you haven’t added anything yet, let’s get you started!"}),e.jsx("br",{}),e.jsx(b,{to:"/collections",onClick:n,prefetch:"viewport",children:"Continue shopping →"})]})}export{U as A,J as C,p as u};
